<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Russian ‚Üí Ancient Greek Reading Trainer</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }
    h1 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .dual-column {
      display: flex;
      gap: 20px;
    }
    textarea, .output {
      width: 100%;
      height: 400px;
      font-size: 1em;
      padding: 10px;
      box-sizing: border-box;
    }
    .output {
      border: 1px solid #ccc;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .output span {
      position: relative;
      cursor: help;
    }
    .output span:hover::before {
      content: attr(data-original);
      position: absolute;
      background: #eee;
      padding: 2px 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      top: -1.5em;
      left: 0;
      white-space: nowrap;
      z-index: 10;
      font-size: 0.85em;
      color: #000;
    }
    .highlight {
      background-color: #ffe08a;
    }
    .half {
      width: 50%;
    }
  </style>
</head>
<body>
  <h1>Russian ‚Üí Ancient Greek Reading Trainer</h1>

  <div class="controls">
    <label>–°—Ç–µ–ø–µ–Ω—å –∑–∞–º–µ–Ω—ã:
  <input type="number" id="intensity" value="100" min="0" max="100" step="10" style="width: 60px;">
  %
</label>
    <button onclick="transformText()">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å</button>
    <button onclick="toggleHighlight()">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</button>
    <button onclick="resetText()">–°–±—Ä–æ—Å–∏—Ç—å</button>
    <button onclick="copyOutput()">üìã</button>
  </div>

  <div class="dual-column">
    <textarea id="inputText" class="half" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º:" oninput="originalText=''"></textarea>
    <div class="output half" id="output" aria-label="–î—Ä–µ–≤–Ω–µ–≥—Ä–µ—á–µ—Å–∫–æ–µ —á—Ç–µ–Ω–∏–µ:"></div>
  </div>

  <script>
    let originalText = '';
    let highlight = true;

    const substitutions = [
      { ru: "—Ñ", gr: "œÜ" },
      { ru: "—Ç", gr: "œÑ" },
      { ru: "–ø", gr: "œÄ" },
      { ru: "–∑", gr: "Œ∂" },
      { ru: "–≥(?=[–µ–∏])", gr: "Œ≥", regex: true },
      { ru: "–≥", gr: "Œ≥" },
      { ru: "—Ö", gr: "œá" },
      { ru: "–≤", gr: "Œ≤" },
      { ru: "–¥", gr: "Œ¥" },
      { ru: "–∫", gr: "Œ∫" },
      { ru: "–ª", gr: "Œª" },
      { ru: "–º", gr: "Œº" },
      { ru: "–Ω", gr: "ŒΩ" },
      { ru: "—Ä", gr: "œÅ" },
      { ru: "—Å", gr: "œÉ" },
      { ru: "—É", gr: "œÖ" },
      { ru: "–∞", gr: "Œ±" },
      { ru: "–µ", gr: "Œµ" },
      { ru: "–∏", gr: "Œπ" },
      { ru: "–æ", gr: "Œø" },
      { ru: "—ç", gr: "Œ∑" },
      { ru: "—è", gr: "ŒπŒ±" },
      { ru: "—é", gr: "ŒπœÖ" },
      { ru: "–π", gr: "Œπ" },
      { ru: "—ë", gr: "ŒπŒø" },
      { ru: "–∫—Å", gr: "Œæ" },
      { ru: "–ø—Å", gr: "œà" },
      { ru: "—Ç—Ö", gr: "Œ∏" },
      { ru: "–¥–∂", gr: "œÑŒ∂" },
      { ru: "–π–æ", gr: "ŒπŒø" },
      { ru: "–∏—è–Ω", gr: "ŒπŒ±ŒΩ" },
      { ru: "–∏—è", gr: "ŒπŒ±" },
      { ru: "ai", gr: "Œ±Œπ" },
      { ru: "ei", gr: "ŒµŒπ" },
      { ru: "oi", gr: "ŒøŒπ" },
      { ru: "ou", gr: "ŒøœÖ" },
      { ru: "eu", gr: "ŒµœÖ" },
      { ru: "au", gr: "Œ±œÖ" }
    ];

    substitutions.sort((a, b) => b.ru.length - a.ru.length);

    function transformText() {
      const inputElem = document.getElementById("inputText");
      const intensityElem = document.getElementById("intensity");
      if (!intensityElem) return;
      const percent = parseInt(intensityElem.value);
      if (!originalText) originalText = inputElem.value;
      const input = inputElem.value;

      let result = '';
      let index = 0;

      while (index < input.length) {
        let matched = false;

        for (let rule of substitutions) {
          let part = input.slice(index);
          let match;

          if (rule.regex) {
            const regex = new RegExp('^' + rule.ru, 'i');
            match = regex.exec(part);
          } else {
            if (part.toLowerCase().startsWith(rule.ru)) {
              match = [part.slice(0, rule.ru.length)];
            }
          }

          if (match) {
            const original = match[0];
            const isUpper = original[0] === original[0].toUpperCase();
            const isAllUpper = original.toUpperCase() === original;
            const replacement = isAllUpper
              ? rule.gr.toUpperCase()
              : isUpper ? rule.gr[0].toUpperCase() + rule.gr.slice(1) : rule.gr;

            const useReplacement = Math.random() * 100 <= percent;

            if (useReplacement) {
              result += highlight ? `<span data-original="${original}" class="highlight">${replacement}</span>` : `<span data-original="${original}">${replacement}</span>`;
            } else {
              result += original;
            }

            index += original.length;
            matched = true;
            break;
          }
        }

        if (!matched) {
          result += input[index];
          index++;
        }
      }

      document.getElementById("output").innerHTML = result;
    }

    function toggleHighlight() {
      highlight = !highlight;
      transformText();
    }

    function adjustIntensity(delta) {
      const input = document.getElementById("intensity");
      if (!input) return;
      let value = Math.round(parseInt(input.value) / 10) * 10 + delta;
      if (value > 100) value = 100;
      if (value < 1) value = 1;
      input.value = value;
      transformText();
    }

    function resetText() {
      document.getElementById("inputText").value = originalText;
      transformText();
    }

    function copyOutput() {
      const output = document.getElementById("output");
      const temp = document.createElement("textarea");
      temp.value = output.innerText;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
      alert("–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
    }
  </script>
</body>
</html>
